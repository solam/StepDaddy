<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>En attente d'un instrument - ...Loops</title><!-- Instrument Collective Loops Waiting room Salle d'attente -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="../common/css/user.css" />
</head>
<body class="waiting">

  <div id="instructions">Get ready for your instrument</div><!-- (...Loops waiting room) Get ready to control your instrument or mixer! -->

  <div class="roundedTwo">
    <input type="checkbox" value="None" id="roundedTwo" name="check" checked/>
    <label for="roundedTwo"></label>
    <span>Check this box to play an instrument (if one is available)</span><!-- Cocher la case pour jouer & recevoir un instrument (si dispo)(se faire assigner un instrument s'il en reste de libre) décocher la case pour arrêter de jouer Uncheck to STOP playing (getting OUT of current jam session) [uncheck to standbye (not participate in the session)] Check button to be part of current collective music performance-->
  </div>

  <div id="tips">
    <h2>Tips:</h2>
    <ul>
      <li>Are you using a <i>smartphone</i>?
       <ul>
        <li>Rotate your device as in "landscape" mode</li>
       </ul> 
       <br/>
      <li>Having an issue?</li>
        <ul>
          <li>Refresh Webpage</li>
          <li>Use Google Chrome browser</li>
       </ul> 
    </ul>  
  </div>

  <br/>
  <a target="_blank" href="http://solam.co/loops/"><img class="rounded" style="" src="Loops-logo-fond_transparent_160px.png" width="100" height="100">
  <!--<span class="decal"> Page Web ...Loops (accessible d'un réseau <!--Wi-Fi-> connecté à internet)</span>--></a>

  <!--<input type="text" value="75" class="dial">-->
  <!--<canvas nx="slider" id="slider1" min="0" max="100" label="freq" value="0.15" val="0.15">0.15</canvas>
  <canvas nx="slider" id="slider1" min="0" max="100" label="freq"></canvas>-->

  <!--<section id="pattern-editor">
    <table>
    </table>
  </section>

  <div id="modifiers"></div>-->

  


  <script src="../common/lib/jquery-1.9.0.min.js"></script>    
  <script src="../common/lib/nexusUI.js"></script>
  <script type="text/javascript">


/*


    <h2>Conseils:</h2>
    <ul>
      <li>Si vous utilisez un <i>smartphone</i>:
       <ul>
        <li>tenez le en mode "paysage"</li>
        <!--<li>configurez le de façon à ce que votre écran ne s'éteigne qu'après 5 minutes d'inactivité, par exemple</li><!!-- ne s'éteigne que toutes les 3 à 5 minutes ->
        <li>pour le domaine loops.play désactivez la traduction automatique des pages Web de l'anglais vers le français</li>-->
       </ul> 
       <br/>
      <li>Si vous rencontrez des problèmes: </li>
        <ul>
          <li>rafraîchissez votre page Web <!--(ctrl+r ou F5 sur ordinateur à clavier --<i>desktop</i>--></li>
          <li>installez et utilisez le navigateur Google Chrome (...Loops ne semble pas fonctionner sous Apple iOS - Safari)</li>
          <!--<li>vérifiez que votre appareil est compatible avec le Wi-Fi N (norme IEEE 802.11n) utilisé par le réseau local loops</li>-->
       </ul> 
    </ul>  



*/


/*
  nx.onload = function() {
  // Slider will not jump to touch position.
  //slider1.value = 0.15;
  slider1.val.value = 15;
  slider1.draw();
  console.log(slider1); // .val.value
  //slider1.hslider = true;
  //slider1.draw();
}  */


      window.roomId = location.href.split('?')[1];
      console.log('window.roomId: ', window.roomId);


      if ( typeof window.roomId == 'undefined' ) {
        window.roomId = 'sdcc';
      }  


// start of maybe unnecessary code

  //$('input#check').prop('checked', true);
  var check = window.localStorage.getItem("check");
  //window.check = check;

  if (typeof check !== 'undefined' && check==1) {
    $('input#roundedTwo').prop('checked', true);  
  } else if (typeof check !== 'undefined' && check==0) {
    $('input#roundedTwo').prop('checked', false);
    window.wait = 1;
  } 

 $(document.body).on('change', 'input#roundedTwo', function () {
   if ($("#roundedTwo").is(':checked')) { 
    localStorage.setItem('check', 1);    
   } else {
    localStorage.setItem('check', 0);
   }
 });  

// end of maybe unnecessary code 

  function getRandomInt(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
  }


  $(document).ready(function () {

    //alert('clear webstorage');
    //localStorage.clear();

/*
  */

/*
$.get( "../sequencer/data.txt", function( data ) {

window['availableSlots'] = data;
//var availSlots = $(data).filter('#audio-server-status').html();  // #audio-server-status
//var availSlots = $(availSlots).filter('#audio-server-available-slots').html();

//var availSlots = $(data).filter('#audio-server-available-slots').text();
console.log(data);

//$( ".result" ).html( data );
//alert( availSlots);


if (data>=1) {
  
}


});

console.log(window['availableSlots']);
*/

/*
var checkAvailableSlots = setInterval(function () {

  $.get( "../sequencer/data.txt", function( data ) {
    console.log('AvailableSlots: ', data);
    localStorage.setItem('availableSlots', data);
  });  

  //var availableSlots = window.localStorage.getItem("availableSlots");
  //console.log(availableSlots);

}, 1000); */

  /*var check = window.localStorage.getItem("check");
  //window.check = check;

  if (typeof check !== 'undefined' && check==1) {
    $('input#roundedTwo').prop('checked', true);  
  } else if (typeof check !== 'undefined' && check==0) {
    $('input#roundedTwo').prop('checked', false);
    window.wait = 1;
  } else if (typeof check == 'undefined' || check==null) {
    $('input#roundedTwo').prop('checked', true); 
    //var check = 1;
    localStorage.setItem('check', 1); 
  } */

$('input#roundedTwo').prop('checked', false);
localStorage.setItem('check', 0);



/*
  $(function() {
    $(".dial").dial();
  }   */   

    //console.log('check: ', check);

    var startDate = new Date();
    var userStartTime = startDate.getTime();    

    var waitingTime = getRandomInt(0, 0); // 40 - 1,15
    //alert(waitingTime);
    var userGoTime = userStartTime + waitingTime*1000;



    var newtimer = setInterval(function () { 
      

      var d = new Date();
      var nowTimeStamp = d.getTime();  
      var check = window.localStorage.getItem("check");
        //console.log('check: ', check);
      var availableSlots = 1; //window.localStorage.getItem("availableSlots");

      if (typeof check !== 'undefined' && check==1 || typeof check == 'undefined') {
        var pause = 0;
      } else if (typeof check !== 'undefined' && check==0) {
        var pause = 1;
      } 
             
      //if (/*typeof window.wait == 'undefined' ||*/ typeof check !== 'undefined' && check==1 || typeof check == 'undefined') {
        if (nowTimeStamp < userGoTime || availableSlots==0 || pause==1) {
          remainingBars = (userGoTime - nowTimeStamp)/1000;
          var remainingBars = Math.floor(remainingBars);

          if (remainingBars>=1 || availableSlots==0 || pause==1) { 

            if (remainingBars>=1) { 
              var passString = remainingBars;
            } else {
              var passString = 0;
            }  

            //var passString = remainingBars; //passCount;
            var instructionString = 'Get ready for your controller in <span id="countdown"></span>'; // for your turn - to control your instrument or mixer in // <span id="slots"> - available slots: '+ availableSlots +'</span> - (...Loops waiting room) 
          } else if (availableSlots>=1 && pause==0 /*availableSlots!=0 && availableSlots!='server-not-ready'*/) {
            var passString = "Go!";
            var instructionString = '<span id="countdown"></span>';
          }
          $("#instructions").show();
          $("#instructions").html(instructionString);
          $("#countdown").html(passString); //
        } else if (nowTimeStamp >= userGoTime && availableSlots>=1 && pause==0) {
          console.log('trying to reach ...Loops instrument or mixer channel');
          //window.location.href = "index.html?rm"; // index.html?rm
          //window.location.href = "index.html?"+window.roomId;
          if ( typeof window.roomId !== 'undefined' ) {
            window.location.href = "https://loops.solam.co/editor/device/?"+window.roomId+"/nomopo"; // index.html?rm - +"/" online version
          }
        }   
      //}   

    }, 1000);

  });    
  
  </script>
</body>
</html>
