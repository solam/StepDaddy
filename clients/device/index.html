<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Instrument - ...Loops</title><!-- Control Kit  -->

<!-- prevent caching during/on dev context -->
<meta HTTP-EQUIV="CACHE-CONTROL" CONTENT="NO-CACHE">
<meta HTTP-EQUIV="PRAGMA" CONTENT="NO-CACHE">


  <meta name="viewport" content="width=device-width"> <!-- , initial-scale=1.0  height=device-height , user-scalable=no  : in portrait mode will adjust to maximum avail screen width | , maximum-scale=1.0: might forbid changing from portrait to landscape modes -->
  <link rel="stylesheet" href="css/style.css" />
  <link rel="stylesheet" href="../common/css/user.css" />
  <link rel="stylesheet" href="../common/lib/noUiSlider/nouislider.min.css" />
  
  <!--<script src="../common/lib/nexusUI.js"></script>-->
</head>
<body id="bodey">



<script>
/*
var win = window.open('http://127.0.0.1:8282/sequencer/?rm/child', '_blank');
if (win) {
    //Browser has allowed it to be opened
    win.focus();
} else {
    //Browser has blocked it
    alert('Please allow popups for this website');
} */

</script>

  <div id="instructions" class="instructions-user"><!--Get ready for your turn!-->
    <span id="countdown"></span>
  </div>  

  <div id="left">
    <ul class="menu" id="fixed">
        <!---->
        
        
        <li id="info-menu"><a href="#notes" class="scrolltop" id="menu-notes">info</a></li><!-- ch annel info-->
        <li id="notes-menu"><a href="#pattern-editor">grid</a></li><!-- draw notes grid grille -->
        <li id="control-menu"><a href="#modifiers">mod 1</a></li><!-- snd & ptn control launch-->
        <li id="tweak-menu"><a href="#slider1">snd 1</a></li><!-- #slider1 tweakA-->
        <li id="tweak-menu2"><a href="#id1">mod 2</a></li><!-- soundB snd B -->
        <li id="menu-sessiontips"><a href="#sessiontips">tips</a></li>
        <li id="exit"><a href="#">exit</a></li> <!-- quitter -->
        <!--<li id="exit"><a href='#' onclick="if ('parentIFrame' in window) window.parentIFrame.size(500);return false;">Size(500)</a></li>-->
        <!--<li><a href="#modulation">mod</a></li> instrument modulation-->
    </ul>
  </div>



  <div id="right">



    <div id="channelinfo">      
      <!--<div id="kitname"></div>-->
      <a class="logo" target="blank" href="http://solam.co/loops/" title="...Loops: multi user music performance Web app"><img src="../common/images/Loops_logo.png"/></a>      
      <div id="channelname">
        <span style="color: white; font-size:20px;">Loading channel</span><!-- instrument en chargement Loading instrument -->
        <!--<span style="color: white; font-size:40px;">pas de session d'impro en cours, revenez à telle heure !</span>-->
      </div>   
      <div id="insname"></div>
      <div id="sessionname"></div>   
      <div id="bpm"></div>
      <div id="notemin"></div>
      <div id="notemax"></div>
    </div>

  <!--<ul class="menu" id="menu-at-notes">
    <li><a href="#notes" class="scrolltop" id="menu-notes">notes</a></li>
    <li><a href="#menu-at-modulation">sound & pattern switch</a></li>
    <li><a href="#modulation">instrument modulation</a></li>
    <div id="channelinfoCANCEL">
      <div id="insnameCANCEL"></div>
      <div id="kitnameCANCEL"></div>
      <div id="bpmCANCEL"></div>
    </div>
  </ul>-->  

  <!--<div id="notes" class="menu-location">&nbsp;</div>-->

<!--<canvas id="canvas" height="600" width="800"></canvas>-->

    <div id="gfx"><span id="instruction">Click to fullscreen me</span></div>

    <script>

    </script>

    <section id="pattern-editor">
      <table>
      </table>
      <div id="keybox" touch-action="none">
        <!--<div id="blackkeys">
            <span id="k61" class="black key"></span><span id="k63" class="black key"></span><span class="spacer"></span><span id="k66" class="black key"></span><span id="k68" class="black key"></span><span id="k70" class="black key"></span><span class="spacer"></span><span id="k73" class="black key"></span><span id="k75" class="black key"></span><span class="spacer"></span><span id="k78" class="black key"></span><span id="k80" class="black key"></span><span id="k82" class="black key"></span>
        </div>-->                
      </div>
    </section>

    


  <!--<ul class="menu" id="menu-at-modulation">
    <li><a href="#notes" class="scrolltop" id="menu-notes">notes</a></li>
    <li><a href="#menu-at-modulation">sound & pattern switch</a></li>
    <li><a href="#modulation">instrument modulation</a></li>
    <div id="channelinfo">
      <div id="insname"></div>
      <div id="kitname"></div>
      <div id="bpm"></div>
    </div>
  </ul>-->

  <!--<div id="modulation" class="menu-location">&nbsp;</div>-->
    <div id="modifiers">
      <!--<div class="interfacePanel" id="sliderPanel"></div>-->
      <!--<div class="ctrlchange" id="id998">
        <select id="kits" name="kits"></select>
      </div>-->
    </div>



    <div id="sessiontips">

      <div id="s9" class="session">
        <h3>Session "Marimba"</h3>
        * une <!--(parties 1 à 8)--> à deux note(s) <!--(partie 9 à 16)--> autorisée(s) par ligne 
        <br>
        * pour déplacer la note, l'effacer d'abord
        <!--changer son déclenchement dans le temps effacer la note d'abord-->
        <br>
        * changer la tonalité <!--(hauteur) de la note via--> avec le menu déroulant <!--"hauteur note (pitch)"-->
        <br>
        * motif répêté toutes les 1, 2, 4, ou 8 mesures <!-- mesures -->

        <!--
        <br>
        16 parties (16 joueurs simultanés maximum)
        <br>
        motif (pattern) de départ pré-programmé
        <br>
        Lorsqu'une partie qui se répête sur plusieurs mesures est abandonnée (un joueur quitte la session) elle se répête sur la mesure abandonnée (jusqu'à ce qu'un prochain joueur prenne le contrôle de la partie).-->      
      </div>   


      <div id="s1" class="session">
        <h3>Session Impro "8 parties avec instruments différents":</h3>
        * activer <!--une ou -->des cases de la grille pour déclencher <!--un ou--> des notes/percussions  
        <br>
        * changer d'instrument mélodique ou de kit de batterie avec le menu déroulant
        <br>
        * (si disponible) modifier les paramètres de synthétiseur avec les <i>sliders</i>
      </div>   

      <div id="s10" class="session">
        <h3>Session "Batucada boîte à rythmes":</h3>
        <div id="part1to4" class="subinfo">
        * parties 1 à 4: changer le motif rythmique uniquement avec menu déroulant "Play pattern" (pas de placement de sons libre) 
        </div> 
        <div id="part5to8" class="subinfo">
        * parties 5 à 8: zéro à deux note(s) autorisée(s) par ligne (pour déplacer une note, l'effacer d'abord)
        <br>
        * motif répêté toutes les mesures      
        </div>    
        <div id="part9to12" class="subinfo">
        * parties 9 à 12: zéro à deux note(s) autorisée(s) par ligne (pour déplacer une note, l'effacer d'abord)
        <br>
        * motif répêté 1 mesure / 2 (alternance avec une mesure de silence)    
        </div>       
        <div id="part13to16" class="subinfo">
        * parties 13 à 16: zéro à quatre note(s) autorisée(s) par ligne (pour déplacer une note, l'effacer d'abord)
        <br>
        * motif répêté 1 mesure / 4 (alternance avec 3 mesures de silence)        
        </div>                    
        * changer de son de batterie avec le menu déroulant "Change sound"
      </div>   



    </div>    


  <select class="dropdownSelect" id="midiIn">
    <!--<option value="1A0CE1F47C19C43DAEB93B9595F6E4BA822ED318FE8D8BF2750B66286B5BEC38" selected="">Midi Through Port-0</option>
    <option value="922CC8EEE2A4A4074067E3FA3CE5E09A763A9487F4BC89E357303B0C5511D875">Komplete Audio 6 MIDI 1</option>-->
  </select>

<!-- (2) comment this to turn off own device precue -->  

<!--<iframe id="myIframe" width="200" height="200"></iframe> 

<div class="devaudioout">
  <div class="roundedTwo">
    <input type="checkbox" value="None" id="roundedTwo" name="deviceaudioout" checked/>
    <label for="roundedTwo"></label>
    <span>Décocher cette case pour couper le son émis par cet appareil</span>
  </div>
</div>-->

<!-- (règlage pris en compte lors du prochain changement d'instrument) par son instrument (sur la sortie son) Cocher la case pour (pouvoir) écouter son instrument sur la sortie son de son appareil (se faire assigner un instrument s'il en reste de libre) décocher la case pour arrêter de jouer Uncheck to STOP playing (getting OUT of current jam session) [uncheck to standbye (not participate in the session)] Check button to be part of current collective music performance
    samples marchent cirrectemetn sur smartphoens synthé ça laggue !
    -->


  </div><!-- end of right --> 

  <!--<iframe src="http://127.0.0.1:8282/sequencer/?rm/child" width="600" height="600"></iframe>-->




  <!--<canvas nx="slider" id="slider1" min="0" max="100" label="freq"></canvas>-->

  <script src="../common/scripts/additional.functions.js"></script>
  <script src="../common/lib/socket.io.js"></script>
  <script src="../common/lib/jquery-2.2.4.min.js"></script><!-- jquery-1.9.0.min.js -->
  <script src="../common/lib/interface.min.js"></script>
  <script src="../common/lib/fastclick.js"></script>
  <script src="../common/lib/wNumb.js"></script>
  <script src="../common/lib/noUiSlider/nouislider.min.js"></script>
  <script src="../common/lib/NoSleep.min.js"></script>
  <script src="../common/lib/iframeResizer.contentWindow.min.js"></script>
  

  <script src="../common/scripts/namespaces.js"></script>
  <script src="../common/scripts/utils.js"></script>
  <script src="../common/scripts/mixins.eventtarget.js"></script>
  <script src="../common/scripts/mixins.wrapper.js"></script>
  <script src="../common/scripts/enum.events.js"></script>
  <script src="../common/scripts/net.connection.js"></script>
  <script src="../common/scripts/net.response.js"></script>
  <script src="../common/scripts/net.proxyrequest.js"></script>
  <script src="../common/scripts/uuid.js"></script>

  <script src="../sequencer/scripts/instruments_config.js"></script>
  <script src="../sequencer/scripts/instruments_config_02.js"></script>
  <script src="../sequencer/scripts/instruments_config_03.js"></script>

  <!--<script src="../common/lib/nexusUI.js"></script>-->
  <script src="../common/scripts/ui.input.js"></script>
  <script src="../common/scripts/ui.slider.js"></script>
  <script src="../common/scripts/ui.ddmenu.js"></script>
  <script src="../common/scripts/ui.contact.js"></script>
  <script src="../common/scripts/ui.keyboard.js"></script>
  
  
  <!--<script src="../common/scripts/synth.js"></script>-->
  <script src="../common/scripts/midi.js"></script>



  <script src="../common/scripts/models.instrument.js"></script>
  <script src="../common/scripts/models.track.js"></script>
  <script src="../common/scripts/models.patterneditor.js"></script>
  <script src="../common/scripts/controllers.patterneditor.js"></script>
  <script src="../common/scripts/views.patterneditor.js"></script>

  <!--<script src="../graphismes/scripts/gestionCanvas.js"></script>-->
  <script src="../graphismes/scripts/graphismes.js"></script>


  <script>


//$(document).ready(function () {


/*

    var deviceaudioout = window.localStorage.getItem("deviceaudioout");
  //window.check = check;

  console.log('deviceaudioout', deviceaudioout);

  if (typeof deviceaudioout !== 'undefined' && deviceaudioout==1) {
    $('input#roundedTwo').prop('checked', true);  
  } else if (typeof deviceaudioout !== 'undefined' && deviceaudioout==0) {
    $('input#roundedTwo').prop('checked', false);
    //window.wait = 1;
  } else if (typeof deviceaudioout == 'undefined' || deviceaudioout==null) {
    $('input#roundedTwo').prop('checked', true); 
    localStorage.setItem('deviceaudioout', 1); 
  } 



//});    

  window.pageId = uuid.v1();

  if (typeof deviceaudioout !== 'undefined' && deviceaudioout==1) {

      //window.pageId = uuid.v1();

      // // (2) comment this to turn off own device precue
      window.setTimeout(function () {
          var iframe = document.getElementById('myIframe');
          iframe.setAttribute('src', 'http://'+window.ip+':8282/sequencer/?rm/child/'+window.pageId);
      }, 300);  // 1000 - 2000
      ///


      // re send currently used LOCAL PATTERN

  } else if (typeof deviceaudioout !== 'undefined' && deviceaudioout==0) {

      window.setTimeout(function () {
          var iframe = document.getElementById('myIframe');
          iframe.setAttribute('src', 'http://'+window.ip+':8282/website/index-void.html');
      }, 300);

  }  


 $(document.body).on('change', 'input#roundedTwo', function () {
   if ($("#roundedTwo").is(':checked')) { 
    localStorage.setItem('deviceaudioout', 1);   
    var iframe = document.getElementById('myIframe');
    iframe.setAttribute('src', 'http://'+window.ip+':8282/sequencer/?rm/child/'+window.pageId);  

//
      // wait 0.7 second before senfing info to rooms for child room to get info and play expected sounds
      window.setTimeout(function () {



    var kitId = $('#kits').find(":selected").val();
      var presetId = $('#presets').find(":selected").val();
      var patternClass = $('#patterns').find(":selected").attr('class'); // 'user'; // 
      var patternId = $('#patterns').find(":selected").val();


      if (typeof window.stepSeq !== 'undefined') {
        window.ptnSeq = {};
        window.ptnSeq.list = window.patternSequencer;
        window.ptnSeq.state = window.stepSeq;
        var ptnSeqString = JSON.stringify(window.ptnSeq);
      } else {
        var ptnSeqString = 0;
      } 



      var elementId = $('#kits').find(":selected").val();
      var classs = $('#patterns').find(":selected").attr('class'); 
      var patternId = $('#patterns').find(":selected").val();



      window.ptnEditorModel.execute(mixr.enums.Events.MODIFIER_CHANGE, {id: 998, x: elementId, y: 0, classs: classs, kitNumber: elementId, patternId: patternId, presetId: presetId, ptnSeq: ptnSeqString});

//


//
    // re send currently used LOCAL PATTERN & PRESET

        if (typeof window.stepSeq !== 'undefined') {
          window.ptnSeq = {};
          window.ptnSeq.list = window.patternSequencer;
          window.ptnSeq.state = window.stepSeq;
          var ptnSeqString = JSON.stringify(window.ptnSeq);
        } else {
          var ptnSeqString = 0;
        }


        var classs = $('#patterns').find(":selected").attr('class');
        var presetId = $('#presets').find(":selected").val();
        var patternId = $('#patterns').find(":selected").val(); 

         var KitNumber = $('#kits').find(":selected").val(); 

         window['userPattern'].id = uuid.v1();
         window['userPattern']._name_ = 'name_'+window['userPattern'].id; //$('#pattern-name').val();
         

         // put 'name' object key as first key to appear into Webstorage key=>value display
         var alphaAscSortedUserPattern = sortObj(window['userPattern'],'asc');
         var ptnString = JSON.stringify(alphaAscSortedUserPattern); 
         var ptnString = ptnString.replace('_name_', 'name'); 



        window.ptnEditorModel.execute(mixr.enums.Events.MODIFIER_CHANGE, {id: 995, x: $item.find("input").val(), y: 0, pattern: ptnString, classs: classs, kitNumber: KitNumber, triggerMode: 'manual', patternId: window['userPattern'].id, presetId: presetId, ptnSeq: ptnSeqString});
        localStorage.setItem('Loops-ptn_'+window['userPattern'].id, ptnString);


        $itemOption = $('<option class="user" id="option'+window['userPattern'].id+'" value="'+window['userPattern'].id+'">'+window['userPattern']._name_+'</option>');
        $itemOption.appendTo(document.getElementById('patterns'));
        if( $('#patterns').length ) {
          $('#patterns option[value="' + window['userPattern'].id + '"]').prop('selected',true);
        }
//



      }, 700);

//

















   } else {
    localStorage.setItem('deviceaudioout', 0);
    var iframe = document.getElementById('myIframe');
    iframe.setAttribute('src', 'http://'+window.ip+':8282/website/index-void.html');    
   }
 }); 


// */



      /*
      window.setTimeout(function () {


        var win = window.open('http://'+window.ip+':8282/sequencer/?rm/child/'+window.pageId, '_blank');
        if (win) {
            //Browser has allowed it to be opened
            //win.focus();
        } else {
            //Browser has blocked it
            alert('Please allow popups for this website');
        }


      }, 5000);  
      // */



  //window.localPatterns = [];  
    /*$("#pattern-editor").hide();
    $("#modifiers").hide();*/

    //*
    window.addEventListener('load', function() {
      new FastClick( document.getElementById('pattern-editor') ); // document.body - document.getElementById('pattern-editor')
    }, false); //*/

/*$(function() {
    FastClick.attach(document.getElementById('pattern-editor')); 
}); */




/*
var modifiers = document.getElementById('bodey');

    $intPanel = $('<div class="interfacePanel" id="sliderPanel">'); 
    $intPanel.appendTo(modifiers);

var a = new Interface.Panel({ 
  container:document.querySelector("#sliderPanel") 
});
var b = new Interface.Slider({
  label: 'vertical slider',  
  bounds:[.05,.05,.3,.9] 
});
var c = new Interface.Slider({ 
  bounds:[.4,.35,.55,.3], 
  label: 'horizontal slider',  
  isVertical:false, 
  value:.5,
});

a.background = 'black';
a.add(b); // ,c
*/






  </script>

  <script src="scripts/device.js"></script>
  <script type="text/javascript">
/*
var windowHeight = $(window).height();
var ptnHeight = 0.7*windowHeight;
//console.log('heights: ', windowHeight, ptnHeight);
$('#pattern-editor').css('height', ptnHeight);
*/


$("a[href='#notes']").click(function() {
  /*$("html, body").animate({ scrollTop: 0 }, "slow"); */
  window.scrollTo(0, 0);
  /*$('#menu-at-modulation').hide();
  $('#menu-at-notes').show();*/
  //  return false;
});



$("a[href='#id1']").click(function() {
  window.scrollTo(0,document.body.scrollHeight);
  //  return false;
});


$(document).ready(function () {

  window.roomIdfirstPass = 'validated';

  setInterval(function () { 


    if ( typeof window.roomId !== 'undefined' ) {

      if ( window.roomIdfirstPass != 'unvalidated') {
        // http://127.0.0.1:8282/device/waiting-room.html
        window.ip = "192.168.1.16";
        $("li#exit a").attr('href', 'http://'+window.ip+':8282/device/waiting-room-exit.html?'+window.roomId);
        //$("li#exit a").attr('href', 'https://loops.solam.co/editor/device/waiting-room-exit.html?'+window.roomId); // online version
        window.roomIdfirstPass = 'unvalidated';
      }

    }  



  }, 1000);  





}); 

var noSleep = new NoSleep();
noSleep.enable();


$('#gfx').click(function(e){
    $('#gfx').toggleClass('fullscreen'); 
});


/*
$("a[href='#menu-at-modulation']").click(function() {
  //$("html, body").animate({ scrollTop: 0 }, "slow"); 
  $('#menu-at-notes').hide();
  $('#menu-at-modulation').show();
  //return false;
});
*/



/*
    nx.onload = function() {
  slider700.val.value = 15;
  slider700.draw();
  console.log(slider1); 

}  */
  
  //window.nx; // try to convert page canvas to useful nexus ui knobs

  //alert('test js');

  //setTimeout(function () { location.reload(true); }, 180000); // refresh page every 3 minutes
    /*
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-3983098-4']);
    _gaq.push(['_setDomainName', '72lions.com']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    */

/*
// if mobile browser hide address bar
if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {

window.scrollTo(0,1);

}
*/

/*
// Shorthand for $( document ).ready()
$(function() {
  $('#midiIn option').val('Komplete Audio 6 MIDI 1').prop('selected',true); // option:eq(2)
});
*/





    if (typeof window['instrumentType'] !== 'undefined' && window['instrumentType'] == 'gfx' ) {
      console.log('gfx call in index.html');
      new Graphismes().initialize();

    }

$("#ctrl1 #input1").trigger("focus");
//document.getElementById("input1").focus();

/*
$( document ).ready(function() {
    //console.log( "ready!" );
    alert('ip: ',window.ip);
});*/

//alert(window.ip);      // 'ip: ', 'string', 






// Your CSS as text
var styles = `
* {
    -o-transition-property: none !important;
    -moz-transition-property: none !important;
    -ms-transition-property: none !important;
    -webkit-transition-property: none !important;
    transition-property: none !important;
}



* {
    -o-transform: none !important;
    -moz-transform: none !important;
    -ms-transform: none !important;
    -webkit-transform: none !important;
    transform: none !important;
}


* {
    -webkit-animation: none !important;
    -moz-animation: none !important;
    -o-animation: none !important;
    -ms-animation: none !important;
    animation: none !important;
}
`

var styleSheet = document.createElement("style");
styleSheet.type = "text/css";
styleSheet.innerText = styles;

if ( top !== self ) { // we are in the iframe
  window.inIframe = 1;
  //console.log('in iFrame');
} else { // not an iframe
  window.inIframe = 0;
  //console.log('not in iFrame');
}


if ( window.inIframe == 1 ) {

  document.head.appendChild(styleSheet);

}











  </script>
</body>
</html>
